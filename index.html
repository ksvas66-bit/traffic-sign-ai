<script>
  const URL = "https://teachablemachine.withgoogle.com/models/DXF2w_wXO/";

  let model, webcam;
  let lastPrediction = "";
  let stableCount = 0;
  const REQUIRED_FRAMES = 8;   // ~0.5 second
  const CONFIDENCE = 0.8;      // 80%

  async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);

    webcam = new tmImage.Webcam(224, 224, false);
    await webcam.setup({ facingMode: "environment" });
    await webcam.play();

    document.getElementById("webcam-container").appendChild(webcam.canvas);
    window.requestAnimationFrame(loop);
  }

  async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
  }

  async function predict() {
    const prediction = await model.predict(webcam.canvas);
    prediction.sort((a, b) => b.probability - a.probability);

    const top = prediction[0];

    if (top.probability > CONFIDENCE) {
      if (top.className === lastPrediction) {
        stableCount++;
      } else {
        lastPrediction = top.className;
        stableCount = 1;
      }

      if (stableCount >= REQUIRED_FRAMES) {
        document.getElementById("label").innerText =
          lastPrediction + " âœ”";
      }
    }
  }
</script>
